 This code didn't port easily. WTF does it do? (sjb)